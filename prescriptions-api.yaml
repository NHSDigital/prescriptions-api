# This is an OpenAPI Specification (https://swagger.io/specification/)
# for the Prescriptions API
# owned by NHS Digital (https://digital.nhs.uk/)

openapi: 3.0.0
x-nhs-api-spec-guid: 816f3e79-1d81-4ae7-af54-dcd4a739d01a
info:
  title: Prescriptions API
  version: "{VERSION}"
  contact:
    name: Prescriptions API Support
    url: "https://digital.nhs.uk/developer/help-and-support"
    email: "api.management@nhs.net"

x-spec-publication:
  operation-order:
    - operations:
        - method: POST
          path: /getMyPrescriptions

paths:
  /getMyPrescriptions:
    post:
      operationId: get-my-prescriptions
      summary: Get prescriptions for the given user
      description: |
        ## Overview
        Use this endpoint to get a Bundle containing a list of the user's prescriptions.
      parameters:
        - $ref: "#/components/parameters/BearerAuthorization"
        - $ref: "#/components/parameters/NhsNumber"
      responses:
        "200":
          description: Successful retrieval.
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/parameters-response"
              examples:
                example:
                  description: |
                    A successful response to a getMyPrescriptions request.
                  value:
                    $ref: examples/getMyPrescriptions/success.json
        "4XX":
          description: Invalid request.
          content:
            application/fhir+json:
              schema:
                $ref: "#/components/schemas/operation-outcome"
              examples:
                example:
                  description: |
                    An error response to a prepare request.
                  value:
                    $ref: examples/spec/errors/example-a-validation-error-missing-field/Response-FhirError.json

components:
  parameters:
    BearerAuthorization:
      in: header
      name: Authorization
      description: |
        An [OAuth 2.0 bearer token](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis).

        Required in all environments except sandbox.
      required: true
      schema:
        type: string
        format: '^Bearer\ [[:ascii:]]+$'
        example: "Bearer g1112R_ccQ1Ebbb4gtHBP1aaaNM"
    NhsNumber:
      in: header
      name: NHS-Number
      description: The NHS number of the patient whose prescriptions are to be returned.
      required: true
      schema:
        type: string
        example: "9434765919"
  schemas:
    operation-outcome:
      $ref: "schemas/components/OperationOutcome/OperationOutcome.yaml"
    parameters-response:
      $ref: "schemas/components/ParametersResponse.yaml"
    Encode-Request-Bundle:
      type: object
      required:
        - resourceType
        - identifier
        - type
        - entry
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Bundle"
        id:
          type: string
          description: object ID for the Bundle.
          enum:
            - "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        identifier:
          type: object
          properties:
            system:
              type: string
              description: codesystem URL for identifiers
              enum:
                - "https://tools.ietf.org/html/rfc4122"
            value:
              type: string
              description: The X-Request ID for the message.
              example: "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        type:
          type: string
          description: The reason why a series of resources and objects are grouped together.
          enum:
            - "message"
        entry:
          type: array
          description: A collection of resources contained within the Bundle.
          items:
            oneOf:
              - $ref: "#/components/schemas/Create-MedicationRequest-Resource"
              - $ref: "#/components/schemas/Create-PractitionerRole-Resource"
              - $ref: "#/components/schemas/Create-Practitioner-Resource"
              - $ref: "#/components/schemas/Create-MessageHeader-Resource"
              - $ref: "#/components/schemas/Create-Patient-Resource"
              - $ref: "#/components/schemas/Create-Organization-Resource"
              - $ref: "#/components/schemas/Create-CommunicationRequest-Resource"
              - $ref: "#/components/schemas/Create-List-Resource"
    Create-Request-Bundle:
      type: object
      required:
        - resourceType
        - identifier
        - type
        - entry
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Bundle"
        id:
          type: string
          description: An object ID for the Bundle.
          enum:
            - "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        identifier:
          type: object
          properties:
            system:
              type: string
              description: codesystem URL for identifiers
              enum:
                - "https://tools.ietf.org/html/rfc4122"
            value:
              type: string
              description: The X-Request ID for the message.
              example: "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        type:
          type: string
          description: The type of payload being carried within the Bundle.
          enum:
            - "message"
        entry:
          type: array
          description: A collection of resources contained within the Bundle.
          items:
            oneOf:
              - $ref: "#/components/schemas/Create-MedicationRequest-Resource"
              - $ref: "#/components/schemas/Create-PractitionerRole-Resource"
              - $ref: "#/components/schemas/Create-Practitioner-Resource"
              - $ref: "#/components/schemas/Create-MessageHeader-Resource"
              - $ref: "#/components/schemas/Create-Patient-Resource"
              - $ref: "#/components/schemas/Create-Organization-Resource"
              - $ref: "#/components/schemas/Create-CommunicationRequest-Resource"
              - $ref: "#/components/schemas/Create-List-Resource"
              - $ref: "#/components/schemas/Create-Provenance-Resource"
    Cancel-Request-Bundle:
      type: object
      required:
        - resourceType
        - identifier
        - type
        - entry
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Bundle"
        id:
          type: string
          description: An object ID for the Bundle.
          enum:
            - "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        identifier:
          type: object
          properties:
            system:
              type: string
              description: codesystem URL for identifiers
              enum:
                - "https://tools.ietf.org/html/rfc4122"
            value:
              type: string
              description: The X-Request ID for the message.
              example: "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        type:
          type: string
          description: The reason why a series of resources and objects are grouped together.
          enum:
            - "message"
        entry:
          type: array
          description: A collection of resources contained within the Bundle.
          items:
            oneOf:
              - $ref: "#/components/schemas/Cancel-Request-MessageHeader-Resource"
              - $ref: "#/components/schemas/Cancel-Request-MedicationRequest-Resource"
              - $ref: "#/components/schemas/Cancel-Request-Patient-Resource"
              - $ref: "#/components/schemas/Cancel-Request-Organization-Resource"
              - $ref: "#/components/schemas/Cancel-Request-CommunicationRequest-Resource"
              - $ref: "#/components/schemas/Cancel-Request-List-Resource"
              - $ref: "#/components/schemas/Cancel-Request-PractitionerRole-Resource"
              - $ref: "#/components/schemas/Cancel-Request-Practitioner-Resource"
    Cancel-Response-Bundle:
      type: object
      required:
        - resourceType
        - identifier
        - type
        - entry
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Bundle"
        id:
          type: string
          description: An object ID for the Bundle.
          enum:
            - "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        identifier:
          type: object
          properties:
            system:
              type: string
              description: codesystem URL for identifiers
              enum:
                - "https://tools.ietf.org/html/rfc4122"
            value:
              type: string
              description: The X-Request ID for the message.
              example: "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        type:
          type: string
          description: The reason why a series of resources and objects are grouped together.
          enum:
            - "message"
        entry:
          type: array
          description: A collection of resources contained within the Bundle.
          items:
            oneOf:
              - $ref: "#/components/schemas/Cancel-Response-MedicationRequest-Resource"
              - $ref: "#/components/schemas/Cancel-Response-MessageHeader-Resource"
              - $ref: "#/components/schemas/Cancel-Response-Patient-Resource"
              - $ref: "#/components/schemas/Cancel-Response-PractitionerRole-Resource"
              - $ref: "#/components/schemas/Cancel-Response-Practitioner-Resource"
              - $ref: "#/components/schemas/Cancel-Response-Organization-Resource"
              - $ref: "#/components/schemas/Cancel-Response-CommunicationRequest-Resource"
              - $ref: "#/components/schemas/Cancel-Response-List-Resource"
    Create-MessageHeader-Resource:
      type: object
      description: MessageHeader
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/MessageHeader/MessageHeader.yaml"
    Create-MedicationRequest-Resource:
      type: object
      description: MedicationRequest
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49bb6"
        resource:
          $ref: "schemas/components/MedicationRequest/MedicationRequest.yaml"
    Create-Patient-Resource:
      type: object
      description: Patient
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Patient/Patient.yaml"
    Create-PractitionerRole-Resource:
      type: object
      description: PractitionerRole
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/PractitionerRole/CreatePractitionerRole.yaml"
    Create-Practitioner-Resource:
      type: object
      description: Practitioner
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Practitioner/CreatePractitioner.yaml"
    Create-Organization-Resource:
      type: object
      description: Organization
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Organization/Organization.yaml"
    Create-List-Resource:
      type: object
      description: List
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/List/CreateList.yaml"
    Create-CommunicationRequest-Resource:
      type: object
      description: CommunicationRequest
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/CommunicationRequest/CommunicationRequest.yaml"
    Create-Location-Resource:
      type: object
      description: Location
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Location/CreateLocation.yaml"
    Create-Provenance-Resource:
      type: object
      description: Provenance
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Provenance/Provenance.yaml"
    Cancel-Request-MessageHeader-Resource:
      type: object
      description: MessageHeader
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/MessageHeader/CancelRequestMessageHeader.yaml"
    Cancel-Request-MedicationRequest-Resource:
      type: object
      description: MedicationRequest
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/MedicationRequest/CancelRequestMedicationRequest.yaml"
    Cancel-Request-Patient-Resource:
      type: object
      description: Patient
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Patient/Patient.yaml"
    Cancel-Request-PractitionerRole-Resource:
      type: object
      description: PractitionerRole
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/PractitionerRole/CancelPractitionerRole.yaml"
    Cancel-Request-Practitioner-Resource:
      type: object
      description: Practitioner
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Practitioner/CancelRequestPractitioner.yaml"
    Cancel-Request-Organization-Resource:
      type: object
      description: Organization
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Organization/Organization.yaml"
    Cancel-Request-List-Resource:
      type: object
      description: List
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/List/CreateList.yaml"
    Cancel-Request-CommunicationRequest-Resource:
      type: object
      description: CommunicationRequest
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/CommunicationRequest/CommunicationRequest.yaml"
    Cancel-Request-Location-Resource:
      type: object
      description: Location
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Location/CreateLocation.yaml"
    Cancel-Response-MessageHeader-Resource:
      type: object
      description: MessageHeader
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/MessageHeader/CancelResponseMessageHeader.yaml"
    Cancel-Response-MedicationRequest-Resource:
      type: object
      description: MedicationRequest
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/MedicationRequest/CancelResponseMedicationRequest.yaml"
    Cancel-Response-Patient-Resource:
      type: object
      description: Patient
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Patient/Patient.yaml"
    Cancel-Response-Practitioner-Resource:
      type: object
      description: Practitioner
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Practitioner/CancelResponsePractitioner.yaml"
    Cancel-Response-PractitionerRole-Resource:
      type: object
      description: PractitionerRole
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/PractitionerRole/CancelPractitionerRole.yaml"
    Cancel-Response-Organization-Resource:
      type: object
      description: Organization
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Organization/Organization.yaml"
    Cancel-Response-List-Resource:
      type: object
      description: List
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/List/CreateList.yaml"
    Cancel-Response-CommunicationRequest-Resource:
      type: object
      description: CommunicationRequest
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/CommunicationRequest/CommunicationRequest.yaml"
    Cancel-Response-Location-Resource:
      type: object
      description: Location
      properties:
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          $ref: "schemas/components/Location/CreateLocation.yaml"
